<!-- templates/base_layout.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}Gesti贸n de Proyectos{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=3.0, user-scalable=yes">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- CSS Base -->
  <link rel="stylesheet" href="{{ url_for('static', path='style_base_layout.css') }}">

  <!-- Bloque para agregar estilos adicionales -->
  {% block head %}{% endblock %}
</head>

<body>
  <!-- Overlay para cerrar men煤 en m贸vil -->
  <div class="sidebar-overlay"></div>
  
  <!-- Л Men煤 lateral -->
  <aside class="sidebar">
    
    <!-- Header del sidebar -->
    <div class="sidebar-header">
      <h3 class="sidebar-title">
        <i class="bi bi-layers"></i>
        <span class="sidebar-text">famtasker</span>
      </h3>
      <button class="sidebar-close" aria-label="Cerrar men煤">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <!-- Men煤 de navegaci贸n -->
    <nav class="sidebar-nav">
      <div class="accordion">

        <!-- Inicio -->
        <div class="accordion-item">
          <a href="/dashboard" class="accordion-link" data-title="Inicio">
            <i class="bi bi-house-door"></i>
            <span class="sidebar-text">Inicio</span>
          </a>
        </div>

        <!-- Ingresos -->
        <div class="accordion-item">
          <button class="accordion-button" data-title="Ingresos">
            <i class="bi bi-cash-stack"></i>
            <span class="sidebar-text">Ingresos</span>
            <i class="bi bi-chevron-right accordion-arrow"></i>
          </button>
          <div class="accordion-content">
            <a href="/ingresos" data-title="Consultar Ingresos">
              <i class="bi bi-list-ul"></i>
              <span class="sidebar-text">Consultar Ingresos</span>
            </a>
          </div>
        </div>

        <!-- Gastos -->
        <div class="accordion-item">
          <button class="accordion-button" data-title="Gastos">
            <i class="bi bi-wallet2"></i>
            <span class="sidebar-text">Gastos</span>
            <i class="bi bi-chevron-right accordion-arrow"></i>
          </button>
          <div class="accordion-content">
            <a href="/gastos" data-title="Consultar Gastos">
              <i class="bi bi-list-ul"></i>
              <span class="sidebar-text">Consultar Gastos</span>
            </a>
          </div>
        </div>

        <!-- Notas pendientes -->
        <div class="accordion-item">
          <a href="/pendientes" class="accordion-link" data-title="Notas pendientes">
            <i class="bi bi-journal-text"></i>
            <span class="sidebar-text">Notas pendientes</span>
          </a>
        </div>

        <!-- Contrase帽as -->
        <div class="accordion-item">
          <button class="accordion-button" data-title="Contrase帽as">
            <i class="bi bi-shield-lock"></i>
            <span class="sidebar-text">Contrase帽as</span>
            <i class="bi bi-chevron-right accordion-arrow"></i>
          </button>
          <div class="accordion-content">
            <a href="/contrasenas" data-title="Ver Contrase帽as">
              <i class="bi bi-key"></i>
              <span class="sidebar-text">Ver Contrase帽as</span>
            </a>
          </div>
        </div>

        <!-- Cumplea帽os -->
        <div class="accordion-item">
          <button class="accordion-button" data-title="Cumplea帽os">
            <i class="bi bi-cake2"></i>
            <span class="sidebar-text">Cumplea帽os</span>
            <i class="bi bi-chevron-right accordion-arrow"></i>
          </button>
          <div class="accordion-content">
            <a href="/cumpleanos" data-title="Ver Cumplea帽os">
              <i class="bi bi-calendar-heart"></i>
              <span class="sidebar-text">Ver Cumplea帽os</span>
            </a>
          </div>
        </div>

        <!-- Separador -->
        <div class="sidebar-divider"></div>

        <!-- Cerrar sesi贸n -->
        <div class="accordion-item">
          <a href="/" class="accordion-link logout-link" data-title="Cerrar sesi贸n">
            <i class="bi bi-box-arrow-right"></i>
            <span class="sidebar-text">Cerrar sesi贸n</span>
          </a>
        </div>

      </div>
    </nav>
  </aside>

  <!-- Contenedor principal -->
  <div class="main-container">
    
    <!-- Topbar con botones de toggle -->
    <div class="topbar">
      <button class="sidebar-toggle" aria-label="Abrir/cerrar men煤">
        <i class="bi bi-list"></i>
      </button>
      <div class="topbar-title">
        {% block page_title %}{% endblock %}
      </div>
    </div>

    <!--  Contenido principal -->
    <main class="main-content">
      
      <!-- Contenido de la p谩gina -->
      <div class="content-wrapper">
        {% block content %}{% endblock %}
      </div>

      <!-- Footer -->
      <footer class="main-footer">
        <div class="footer-content">
          <div class="footer-section">
            <h4 class="footer-title">
              <i class="bi bi-code-slash"></i> Desarrollado por
            </h4>
            <p class="footer-text">Ra煤l Eduardo Ba帽os Mu帽oz</p>
          </div>

          <div class="footer-section">
            <h4 class="footer-title">
              <i class="bi bi-telephone"></i> Contacto
            </h4>
            <div class="contact-info">
              <a href="tel:+573113962704" class="footer-link">
                <i class="bi bi-phone"></i> +57 311 396 2704
              </a>
              <a href="mailto:rauleduardo1992@hotmail.com" class="footer-link">
                <i class="bi bi-envelope"></i> rauleduardo1992@hotmail.com
              </a>
            </div>
          </div>

          <div class="footer-section">
            <h4 class="footer-title">
              <i class="bi bi-c-circle"></i> Derechos de Autor
            </h4>
            <p class="footer-text">
              &copy; <span id="currentYear"></span> Famtasker. Todos los derechos reservados.
            </p>
            <p class="footer-disclaimer">
              Este software es propiedad intelectual del desarrollador.
            </p>
          </div>
        </div>
        
        <div class="footer-bottom">
          <p class="copyright-text">
            <i class="bi bi-shield-check"></i> 
            Prohibida la reproducci贸n total o parcial sin autorizaci贸n expresa.
          </p>
        </div>
      </footer>
    </main>

  </div>

  <!-- JS para sidebar y acorde贸n -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.querySelector('.sidebar-overlay');
      const toggleBtn = document.querySelector('.sidebar-toggle');
      const closeBtn = document.querySelector('.sidebar-close');
      const accordionButtons = document.querySelectorAll('.accordion-button');
      const mainContainer = document.querySelector('.main-container');
      const body = document.body;

      // Estado del sidebar
      let sidebarHidden = localStorage.getItem('sidebarHidden') === 'true';
      
      // Funci贸n para verificar si es m贸vil
      function isMobile() {
        return window.innerWidth <= 768;
      }

      // Funci贸n para ocultar/desocultar sidebar
      function toggleSidebar() {
        if (isMobile()) {
          // En m贸vil: men煤 deslizante
          sidebar.classList.toggle('active');
          overlay.classList.toggle('active');
          body.classList.toggle('sidebar-open');
        } else {
          // En desktop: ocultar/desocultar
          sidebarHidden = !sidebarHidden;
          localStorage.setItem('sidebarHidden', sidebarHidden);
          
          if (sidebarHidden) {
            sidebar.classList.add('hidden');
            mainContainer.classList.add('sidebar-hidden');
          } else {
            sidebar.classList.remove('hidden');
            mainContainer.classList.remove('sidebar-hidden');
          }
        }
      }

      // Funci贸n para inicializar el estado del sidebar
      function initSidebar() {
        if (isMobile()) {
          // En m贸vil: siempre visible al deslizar
          sidebar.classList.remove('hidden');
          sidebar.classList.remove('active');
          overlay.classList.remove('active');
          body.classList.remove('sidebar-open');
          mainContainer.classList.remove('sidebar-hidden');
        } else {
          // En desktop: restaurar estado guardado
          if (sidebarHidden) {
            sidebar.classList.add('hidden');
            mainContainer.classList.add('sidebar-hidden');
          } else {
            sidebar.classList.remove('hidden');
            mainContainer.classList.remove('sidebar-hidden');
          }
        }
      }

      // Inicializar sidebar
      initSidebar();

      // Abrir/cerrar con bot贸n toggle
      toggleBtn?.addEventListener('click', toggleSidebar);

      // Cerrar con bot贸n X (solo m贸vil)
      closeBtn?.addEventListener('click', () => {
        if (isMobile()) {
          sidebar.classList.remove('active');
          overlay.classList.remove('active');
          body.classList.remove('sidebar-open');
        }
      });

      // Cerrar con overlay (solo m贸vil)
      overlay?.addEventListener('click', () => {
        if (isMobile()) {
          sidebar.classList.remove('active');
          overlay.classList.remove('active');
          body.classList.remove('sidebar-open');
        }
      });

      // Manejar acorde贸n
      accordionButtons.forEach(button => {
        button.addEventListener('click', (e) => {
          e.stopPropagation();
          const item = button.parentElement;
          
          if (!isMobile() && sidebar.classList.contains('hidden')) {
            // Si sidebar est谩 oculto en desktop, primero mostrarlo
            sidebarHidden = false;
            localStorage.setItem('sidebarHidden', 'false');
            sidebar.classList.remove('hidden');
            mainContainer.classList.remove('sidebar-hidden');
            
            // Luego abrir el acorde贸n
            setTimeout(() => {
              item.classList.toggle('active');
            }, 100);
          } else {
            // Comportamiento normal
            item.classList.toggle('active');
          }
        });
      });

      // Cerrar sidebar m贸vil al hacer click en un link
      document.querySelectorAll('.accordion-link, .accordion-content a').forEach(link => {
        link.addEventListener('click', () => {
          if (isMobile()) {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
            body.classList.remove('sidebar-open');
          }
        });
      });

      // Manejar resize
      function handleResize() {
        initSidebar();
      }

      // Escuchar cambios de tama帽o
      window.addEventListener('resize', handleResize);

      // A帽o actual para el copyright
      const yearSpan = document.getElementById('currentYear');
      if (yearSpan) {
        yearSpan.textContent = new Date().getFullYear();
      }
    });
  </script>

  <!-- Bloque adicional para scripts -->
  {% block extra_scripts %}{% endblock %}
</body>
</html>